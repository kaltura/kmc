<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" verticalAlign="middle" horizontalScrollPolicy="off">
	<mx:Script>
		<![CDATA[
			import com.kaltura.kmc.modules.content.view.window.flavors.FilesTable;
			import com.kaltura.kmc.modules.content.vo.UploadFileVo;
			import com.kaltura.vo.KalturaConversionProfileAssetParams;
			import com.kaltura.vo.KalturaFlavorParams;
			
			import flash.utils.flash_proxy;
			
			import mx.events.ListEvent;
			import mx.resources.ResourceManager;


			/**
			 * Object of type <code>UploadFileVo</code>
			 * */
			override public function set data(value:Object):void {
				super.data = value;
				if (value) {
					cb.enabled = true;
					cb.dataProvider = value.flavors; // KalturaFlavorParams objects
					if (cb.dropdown) {
						cb.dropdown.dataProvider = value.flavors;
					}
					selectFlavor(value as UploadFileVo);
				}
			}


			/**
			 * for when changing only a single flavor (?)
			 * show the correct flavorParamId in the CB.
			 * otherwise use the file name pattern to "guess" flavor.
			 * */
			protected function selectFlavor(ufv:UploadFileVo):void {
				var found:Boolean;
				var o:KalturaConversionProfileAssetParams;
				
				// if a flavor was defined for this file (vo)
				for each(o in ufv.flavors) {
					if (o.assetParamsId.toString() == ufv.flavorParamId) {
						cb.selectedItem = o;
						found = true;
						break;
					}
				}
				// if no flavor was defined, try matching by flavor system name
				if (!found) {
					// use the flavor system name and file name to "guess" flavor.
					for each(o in ufv.flavors) {
						//TODO need the systemname from the CPAP, not from the flavorParams
						if (ufv.fileName.indexOf(o.systemName) != -1) {
							cb.selectedItem = o;
							ufv.flavorParamId = o.assetParamsId.toString();
							found = true;
							break;
						}
					}
				}
				// if that failed too, prompt "select".
				if (!found) {
					ufv.flavorParamId = '';
					cb.prompt = ResourceManager.getInstance().getString('cms', 'selectFlavorPrompt');
					cb.enabled = false;
					
					
//					cb.selectedIndex = 0;
//					if (ufv.flavors) {
//						ufv.flavorParamId = ufv.flavors.getItemAt(0).id.toString();
//					}
//					else {
//						ufv.flavorParamId = '';
//					}
				}
				
			}


			protected function combobox1_changeHandler(event:ListEvent):void {
				dispatchEvent(new Event(FilesTable.FLAVOR_SELECTED, true));
			}


			public function get selectedFlavor():KalturaConversionProfileAssetParams {
				return cb.selectedItem as KalturaConversionProfileAssetParams;
			}

//			public function set selectedFlavor(value:KalturaFlavorParams):void {
//				cb.selectedItem = value;
//			}
		]]>
	</mx:Script>
	<mx:ComboBox id="cb" change="combobox1_changeHandler(event)" labelField="name" width="100%"/>
</mx:HBox>
